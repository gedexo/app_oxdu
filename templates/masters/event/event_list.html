{% extends 'app/base.html' %}
{% load static i18n crispy_forms_tags django_tables2 %}
{% block title %}{{title|title}} : {{app_settings.site_title}}{% endblock %}

{% block content %}

<div class="main-content app-content">

  <div class="container-fluid">


    <!-- Page Header -->
    <div class="page-header d-flex d-block justify-content-between">
      <div class="page-leftheader">
        <div class="page-title">{{title|title}}</div>
      </div>
    </div>
    <!-- Page Header Close -->

    <div class="row g-4">
        {% for event in events %}
        <div class="col-12 col-md-6 col-lg-3">
            <div class="event-card position-relative">
                <div class="event-image-container position-relative">
                    {% if event.image %}
                    <img src="{{ event.image.url }}" class="card-img-top clickable-image" 
                         alt="{{ event.title }}" 
                         data-bs-toggle="modal" 
                         data-bs-target="#imageModal{{ forloop.counter }}"
                         data-image-url="{{ event.image.url }}"
                         data-event-url="{% if event.url %}{{ event.url }}{% endif %}"
                         data-event-title="{{ event.title }}">
                    {% else %}
                    <img src="{% static 'images/default-event.jpg' %}" class="card-img-top clickable-image" 
                         alt="Default Event"
                         data-bs-toggle="modal" 
                         data-bs-target="#imageModal{{ forloop.counter }}"
                         data-image-url="{% static 'images/default-event.jpg' %}"
                         data-event-url="{% if event.url %}{{ event.url }}{% endif %}"
                         data-event-title="{{ event.title }}">
                    {% endif %}
                    <!-- Black Overlay -->
                    <div class="event-overlay"></div>
                    <!-- Event Text Content -->
                    <div class="event-content position-absolute bottom-0 start-0 end-0 p-3 text-white">
                        <h5 class="event-title mb-1">{{ event.title }}</h5>
                        {% if event.date %}
                        <p class="event-date mb-1 small">
                            <i class="fe fe-calendar me-1"></i>{{ event.date|date:"M d, Y" }}
                        </p>
                        {% endif %}
                        {% if event.location %}
                        <p class="event-location mb-0 small">
                            <i class="fe fe-map-pin me-1"></i>{{ event.location }}
                        </p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for each event -->
        <div class="modal fade" id="imageModal{{ forloop.counter }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content bg-transparent border-0">
                    <div class="modal-body text-center p-0">
                        {% if event.url %}
                        <a href="{{ event.url }}" target="__blank" class="d-block modal-image-link">
                            {% if event.image %}
                            <img src="{{ event.image.url }}" class="img-fluid rounded modal-image" alt="{{ event.title }}">
                            {% else %}
                            <img src="{% static 'images/default-event.jpg' %}" class="img-fluid rounded modal-image" alt="Default Event">
                            {% endif %}
                        </a>
                        {% else %}
                        {% if event.image %}
                        <img src="{{ event.image.url }}" class="img-fluid rounded modal-image" alt="{{ event.title }}">
                        {% else %}
                        <img src="{% static 'images/default-event.jpg' %}" class="img-fluid rounded modal-image" alt="Default Event">
                        {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <p>No events found.</p>
        </div>
        {% endfor %}
    </div>
  </div>

</div>

{% for new_html in includes %}
  {% include new_html %}
{% endfor %}

{% include 'app/partials/filter.html' %}
{% include 'app/partials/help.html' %}

{% endblock content %}

{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function copyBrochureLink(url) {
    navigator.clipboard.writeText(url).then(() => {
        const alert = document.createElement('div');
        alert.className = 'custom-copy-alert';
        alert.innerHTML = `
            <div class="alert-icon">
                <svg width="24" height="24" viewBox="0 0 24 24">
                    <path fill="none" stroke="white" stroke-width="3" d="M5 13l4 4L19 7"/>
                </svg>
            </div>
            <div class="alert-text">Link Copied!</div>
        `;
        document.body.appendChild(alert);

        setTimeout(() => {
            alert.classList.add('show');
        }, 10);

        setTimeout(() => {
            alert.classList.remove('show');
            setTimeout(() => alert.remove(), 300);
        }, 2000);
    });
}

// Optional: Add click handler for modal images without URLs
document.addEventListener('DOMContentLoaded', function() {
    // Make modal images without links clickable to close modal
    document.querySelectorAll('.modal-image:not(.modal-image-link img)').forEach(img => {
        img.style.cursor = 'pointer';
        img.addEventListener('click', function() {
            const modal = this.closest('.modal');
            if (modal) {
                const bootstrapModal = bootstrap.Modal.getInstance(modal);
                bootstrapModal.hide();
            }
        });
    });
});
</script>

{% endblock %}
{% block extra_css %}
<style>
.custom-copy-alert {
    position: fixed;
    top: 20%;
    left: 50%;
    transform: translateX(-50%) scale(0.8);
    background: rgba(76, 175, 80, 0.85); /* Green transparent */
    color: #fff;
    padding: 12px 20px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
    z-index: 9999;
    backdrop-filter: blur(6px); /* optional for frosted look */
}

.custom-copy-alert.show {
    opacity: 1;
    transform: translateX(-50%) scale(1);
}

.custom-copy-alert .alert-icon svg {
    stroke-dasharray: 40;
    stroke-dashoffset: 40;
    animation: draw 0.4s forwards;
}

@keyframes draw {
    to { stroke-dashoffset: 0; }
}

.event-card {
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    cursor: pointer;
}

.event-image-container {
    border-radius: 10px;
    overflow: hidden;
}

.event-card img {
    height: 550px;
    width: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.event-card:hover img {
    transform: scale(1.05);
}

.event-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        to bottom,
        transparent 0%,
        transparent 50%,
        rgba(0, 0, 0, 0.7) 100%
    );
    pointer-events: none;
}

.event-content {
    z-index: 2;
    pointer-events: none;
}

.event-title {
    font-weight: 600;
    font-size: 1.1rem;
    line-height: 1.3;
    color: #ffffff !important; /* Ensure white color */
}

.event-date, .event-location {
    opacity: 0.9;
    color: #ffffff !important; /* Ensure white color */
}

.event-date i, .event-location i {
    color: #ffffff !important; /* Ensure icons are white too */
}

/* Modal Styles */
.modal-content {
    background: transparent !important;
    box-shadow: none !important;
}

.modal-image {
    max-height: 80vh;
    width: auto;
    max-width: 100%;
    object-fit: contain;
    cursor: pointer;
    transition: transform 0.2s ease;
}

.modal-image:hover {
    transform: scale(1.02);
}

.modal-image-link {
    display: inline-block;
    border-radius: 10px;
    overflow: hidden;
}

.modal-backdrop {
    background-color: rgba(0, 0, 0, 0.85);
}

.modal-backdrop.show {
    opacity: 0.9;
}

/* Clickable image cursor */
.clickable-image {
    cursor: pointer;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .event-card img {
        height: 430px;
    }
    
    .event-title {
        font-size: 1rem;
    }
    
    .modal-dialog {
        margin: 20px;
    }
}
</style>
{% endblock %}