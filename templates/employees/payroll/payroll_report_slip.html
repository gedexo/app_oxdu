{% load static i18n crispy_forms_tags django_tables2 extras humanize %}
<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="ThemeMarch">
    <title>Employee Salary Slip</title>
    <link rel="stylesheet" href="{% static 'app/css/payroll_slip/style.css' %}">
    <style>
        /* Center SALARY SLIP heading */
        .cs-invoice_head .cs-logo p.cs-f20 {
            text-align: center;
            font-size: 24px;
            margin: 0 auto 15px auto;
        }

        /* Compact filter section */
        .cs-filter-container {
            padding: 8px 12px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            background-color: #f1f3f5;
        }

        .cs-filter-form {
            display: flex;
            flex-wrap: nowrap;
            align-items: center;
            gap: 8px;
            margin: 0;
        }

        .cs-filter-label {
            font-weight: 600;
            color: #495057;
            margin: 0;
            white-space: nowrap;
        }

        .cs-filter-select {
            flex: 1;
            min-width: 150px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 13px;
            background-color: white;
            color: #495057;
            height: 34px;
        }

        .cs-filter-button {
            background-color: #405189;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
        }

        .cs-filter-button:hover {
            background-color: #364574;
        }

        /* Responsive adjustments */
        @media (max-width: 576px) {
            .cs-filter-form {
                flex-direction: column;
                align-items: stretch;
            }

            .cs-filter-select, .cs-filter-button {
                width: 100%;
            }
        }

        /* Keep existing styles */
        .table-head-area{
            display: flex !important;
            justify-content: space-between !important;
        }
        .header-logo img{
            height: 40px !important;
        }
        .cs-justify-between {
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>

<body>
    <div class="cs-container">
        <div class="cs-invoice cs-style1">
            <div class="cs-invoice_in" id="download_section">
                <!-- Logo -->
                <div class="cs-invoice_head cs-type1 cs-mb25">
                    <div class="cs-invoice_left">
                    <div class="cs-logo cs-mb5 header-logo"><img src="{% static 'app/assets/images/brand-logos/desktop-logo.png' %}" alt="Logo"></div>
                    </div>

                    <div class="cs-invoice_left">
                    <div class="cs-logo cs-mb5"><p class="cs-m0 cs-f20 text-transform-uppercase cs-primary_color cs-bold">SALARY SLIP</p></div>
                    </div>

                </div>

                <!-- Filter Section -->
                <div class="cs-filter-container">
                    <form method="get" class="cs-filter-form">
                        <label for="payroll" class="cs-filter-label">Select Payroll:</label>
                        <select name="payroll" id="payroll" class="cs-filter-select">
                            {% for payroll in payroll_list %}
                                <option value="{{ payroll.id }}"
                                    {% if latest_payroll.id == payroll.id %}selected{% endif %}>
                                    {{ payroll.label }}
                                </option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="cs-filter-button">Filter</button>
                    </form>
                </div>

                <!-- Employee Info -->
                <ul class="cs-list cs-style2">
                    <li style="display: flex; justify-content: space-between;">
                        <div>Staff ID: <b class="cs-primary_color cs-semi_bold">{{ employee.employee_id }}</b></div>
                        <div>Date: <b class="cs-primary_color cs-semi_bold">{{ current_date }}</b></div>
                    </li>
                    <li style="display: flex; justify-content: space-between;">
                        <div>Staff Name: <b class="cs-primary_color cs-semi_bold">{{ employee.fullname }}</b></div>
                        <div>Bank: <b class="cs-primary_color cs-semi_bold">{{ employee.bank_name|default:"" }}</b></div>
                    </li>
                    <li style="display: flex; justify-content: space-between;">
                        <div>Department: <b class="cs-primary_color cs-semi_bold">{{ employee.department }}</b></div>
                        <div>Account Number: <b class="cs-primary_color cs-semi_bold">{{ employee.account_number|default:"" }}</b></div>
                    </li>
                </ul>

                <!-- Salary Table -->
                <div class="cs-table cs-style2 cs-f12">
                    <div class="cs-round_border">
                        <div class="cs-table_responsive">
                            <table>
                                <thead>
                                    <tr class="cs-focus_bg">
                                        <th class="cs-width_1 cs-text_center cs-semi_bold cs-primary_color">Paid Leave</th>
                                        <th class="cs-width_1 cs-text_center cs-semi_bold cs-primary_color">Full Day Leave</th>
                                        <th class="cs-width_1 cs-text_center cs-semi_bold cs-primary_color">Half Day Leave</th>
                                        <th class="cs-width_1 cs-text_center cs-semi_bold cs-primary_color">Total Leave</th>
                                        <th class="cs-width_1 cs-text_center cs-semi_bold cs-primary_color">Basic Salary</th>
                                        {% if latest_payroll.allowances > 0 %}
                                            <th class="cs-width_1 cs-text_center cs-semi_bold cs-primary_color">Allowances</th>
                                        {% endif %}
                                        <th class="cs-width_1 cs-text_center cs-semi_bold cs-primary_color">Net Salary</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="cs-text_center">{{ paid_leave }}</td>
                                        <td class="cs-text_center">{{ full_day_leave }}</td>
                                        <td class="cs-text_center">{{ half_day_leave }}</td>
                                        <td class="cs-text_center cs-semi_bold">{{ total_leave }}</td>
                                        <td class="cs-text_center cs-semi_bold">₹{{ latest_payroll.basic_salary }}</td>
                                        {% if latest_payroll.allowances > 0 %}
                                            <td class="cs-text_center cs-semi_bold">₹{{ latest_payroll.allowances }}</td>
                                        {% endif %}
                                        <td class="cs-text_center cs-dip_green_color cs-semi_bold">₹{{ latest_payroll.net_salary }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Advance Payment Table -->
                <div class="cs-mb30"></div>
                <div class="cs-table cs-style2 cs-f12">
                    <div class="cs-round_border">
                        <div class="cs-table_responsive">
                            <table>
                                <thead>
                                    <tr class="cs-focus_bg">
                                        <th class="cs-width_3 cs-semi_bold cs-primary_color">Advance Payment Date</th>
                                        <th class="cs-width_1 cs-semi_bold cs-primary_color">Payment Method</th>
                                        <th class="cs-width_1 cs-semi_bold cs-primary_color">Remarks</th>
                                        <th class="cs-width_1 cs-semi_bold cs-primary_color">Amount Paid</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {% for payment in advance_payment_lists %}
                                    <tr>
                                        <td>{{ payment.payment_date }}</td>
                                        <td>{{ payment.payment_method }}</td>
                                        <td>{{ payment.remarks|default:"-" }}</td>
                                        <td class="cs-semi_bold">₹{{ payment.amount_paid|intcomma }}</td>
                                    </tr>
                                {% empty %}
                                    <tr>
                                        <td colspan="4" class="cs-text_center cs-semi_bold cs-primary_color">No advance payments.</td>
                                    </tr>
                                {% endfor %}
                                {% if advance_payment_lists %}
                                    <tr class="cs-focus_bg">
                                        <td colspan="3" class="cs-semi_bold cs-primary_color text-end">Total Advance Paid</td>
                                        <td class="cs-dip_green_color cs-bold">₹{{ total_advance|intcomma }}</td>
                                    </tr>
                                {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Payment Table -->
                <div class="cs-mb30"></div>
                <div class="cs-table cs-style2 cs-f12">
                    <div class="cs-round_border">
                        <div class="cs-table_responsive">
                            <table>
                                <thead>
                                    <tr class="cs-focus_bg">
                                        <th class="cs-width_3 cs-semi_bold cs-primary_color">Payment Date</th>
                                        <th class="cs-width_1 cs-semi_bold cs-primary_color">Payment Method</th>
                                        <th class="cs-width_1 cs-semi_bold cs-primary_color">Remarks</th>
                                        <th class="cs-width_1 cs-semi_bold cs-primary_color">Amount Paid</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {% for payment in payment_lists %}
                                    <tr>
                                        <td>{{payment.payment_date}}</td>
                                        <td>{{payment.payment_method}}</td>
                                        <td>{{payment.remarks|default:"-"}}</td>
                                        <td class="cs-semi_bold">₹{{payment.amount_paid|intcomma}}</td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="4" class="cs-text_center cs-semi_bold cs-primary_color">No payment records available.</td>
                                    </tr>
                                    {% endfor %}

                                    {% if payment_lists %}
                                    <tr class="cs-focus_bg">
                                        <td colspan="3" class="cs-semi_bold cs-primary_color text-end">Total Paid</td>
                                        <td class="cs-dip_green_color cs-bold">₹{{ total_paid|intcomma }}</td>
                                    </tr>
                                    {% endif %}
                                    <tr class="cs-bg">
                                        <td colspan="3" class="cs-semi_bold cs-primary_color text-end">Selected Month Balance</td>
                                        <td class="cs-dip_red_color cs-bold">₹{{ month_balance|intcomma }}</td>
                                    </tr>

                                    <tr class="cs-bg">
                                        <td colspan="3" class="cs-semi_bold cs-primary_color text-end">Balance Amount</td>
                                        <td class="cs-dip_red_color cs-bold">₹{{ pending_due|intcomma }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Buttons -->
        <div class="cs-invoice_btns cs-hide_print">
            <a href="javascript:window.print()" class="cs-invoice_btn cs-color1">
                <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512">
                    <path
                        d="M384 368h24a40.12 40.12 0 0040-40V168a40.12 40.12 0 00-40-40H104a40.12 40.12 0 00-40 40v160a40.12 40.12 0 0040 40h24"
                        fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" />
                    <rect x="128" y="240" width="256" height="208" rx="24.32" ry="24.32" fill="none"
                        stroke="currentColor" stroke-linejoin="round" stroke-width="32" />
                    <path d="M384 128v-24a40.12 40.12 0 00-40-40H168a40.12 40.12 0 00-40 40v24" fill="none"
                        stroke="currentColor" stroke-linejoin="round" stroke-width="32" />
                    <circle cx="392" cy="184" r="24" />
                </svg>
                <span>Print</span>
            </a>
            <button id="download_btn" class="cs-invoice_btn cs-color2">
                <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512">
                    <title>Download</title>
                    <path
                        d="M336 176h40a40 40 0 0140 40v208a40 40 0 01-40 40H136a40 40 0 01-40-40V216a40 40 0 0140-40h40"
                        fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="32" />
                    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="32" d="M176 272l80 80 80-80M256 48v288" />
                </svg>
                <span>Download</span>
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{% static 'app/js/payroll_slip/jquery.min.js' %}"></script>
    <script src="{% static 'app/js/payroll_slip/jspdf.min.js' %}"></script>
    <script src="{% static 'app/js/payroll_slip/html2canvas.min.js' %}"></script>
    <script src="{% static 'app/js/payroll_slip/main.js' %}"></script>
</body>
</html>
